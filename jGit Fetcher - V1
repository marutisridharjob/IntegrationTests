To connect to a Git repository and fetch files programmatically in Java, you can use the JGit library, an open-source, Java-based Git library provided by the Eclipse Foundation.

Here’s a simple example of how to do this:

project-root/
├── src/
│   ├── main/
│   │   ├── java/
│   │   │   └── com/
│   │   │       └── example/
│   │   │           └── gitfetcher/
│   │   │               └── GitRepositoryFetcher.java
│   │   └── resources/
│   └── test/
│       ├── java/
│       └── resources/
├── pom.xml  # Maven configuration file
└── README.md

	1.	Add JGit to your project dependencies. If you’re using Maven, add the following to your pom.xml:


<dependency>
    <groupId>org.eclipse.jgit</groupId>
    <artifactId>org.eclipse.jgit</artifactId>
    <version>6.3.0.202209071007-r</version>
</dependency>


2.	Use the following code to clone a repository and fetch files:

import org.eclipse.jgit.api.Git;
import org.eclipse.jgit.api.errors.GitAPIException;
import org.eclipse.jgit.transport.UsernamePasswordCredentialsProvider;
import java.io.File;

public class GitRepositoryFetcher {
    public static void main(String[] args) {
        String repoUrl = "https://github.com/user/repository.git"; // Replace with your repository URL
        String localRepoPath = "path/to/local/folder";             // Replace with your local path
        String username = "your-username";                         // Replace with your GitHub username
        String token = "your-personal-access-token";               // Replace with your GitHub token

 // Retrieve credentials from environment variables or use default values
//        String username = System.getenv().getOrDefault("GIT_USERNAME", "default-username");
//        String token = System.getenv().getOrDefault("GIT_TOKEN", "default-token");


        try {
            // Clone the repository with authentication
            Git git = Git.cloneRepository()
                    .setURI(repoUrl)
                    .setDirectory(new File(localRepoPath))
                    .setCredentialsProvider(new UsernamePasswordCredentialsProvider(username, token))
                    .call();
            System.out.println("Repository cloned to " + localRepoPath);

            // Fetch files (optional if just cloning)
            git.fetch()
               .setCredentialsProvider(new UsernamePasswordCredentialsProvider(username, token))
               .call();
            System.out.println("Fetched latest files from remote repository");

            git.close();
        } catch (GitAPIException e) {
            e.printStackTrace();
        }
    }
}

Explanation

	1.	Repository URL (repoUrl): Replace with the URL of the repository you want to clone.
	2.	Local Directory (localRepoPath): Replace with the path where you want to clone the repository.
	3.	Credentials:
	•	Username: Set your GitHub username.
	•	Token: Set your GitHub Personal Access Token (PAT). This replaces the password for GitHub’s API.

Security Tip

For security, avoid hardcoding sensitive data directly in your code. Instead, consider using environment variables or a secure secrets management solution to store your credentials. For instance:


String username = System.getenv("GIT_USERNAME");
String token = System.getenv("GIT_TOKEN");

Explanation

	1.	Environment Variables:
	•	System.getenv().getOrDefault("GIT_USERNAME", "default-username") checks for an environment variable called GIT_USERNAME.
	•	If it’s set, it uses that value; otherwise, it falls back to "default-username".
Similarly, GIT_TOKEN is checked and defaults to "default-token" if not found.
	2.	Setting Environment Variables (Locally):
	•	In Unix-based systems (Linux, macOS), set variables in your terminal:


export GIT_USERNAME="your-username"
export GIT_TOKEN="your-token"

In Windows, set variables in the command prompt:

setx GIT_USERNAME "your-username"
setx GIT_TOKEN "your-token"


------------------------------------------------------------------------------------------------------------------------

To search for the Git repository URL within a project directory and then clone it, you can write a Java program to:

	1.	Traverse the project directory for a file (e.g., config.properties or .git/config) that contains the repository URL.
	2.	Extract the URL from this file.
	3.	Use the URL to clone or fetch the repository.

Here’s an example of how to achieve this:

Java Code Example

This program will:

	•	Search the directory for a specific file (config.properties or .git/config).
	•	Read the URL from this file.
	•	Clone or fetch the repository using JGit.

import org.eclipse.jgit.api.Git;
import org.eclipse.jgit.api.errors.GitAPIException;
import org.eclipse.jgit.transport.UsernamePasswordCredentialsProvider;

import java.io.BufferedReader;
import java.io.File;
import java.io.FileReader;
import java.io.IOException;
import java.util.regex.Matcher;
import java.util.regex.Pattern;

public class GitRepositorySearcher {
    public static void main(String[] args) {
        String projectRootPath = "path/to/your/project"; // Path to your local project folder
        String localRepoPath = "path/to/clone/repo";     // Where you want to clone the repo

        // Credentials (from environment or default values)
        String username = System.getenv().getOrDefault("GIT_USERNAME", "default-username");
        String token = System.getenv().getOrDefault("GIT_TOKEN", "default-token");

        try {
            // Step 1: Search for the repository URL
            String repoUrl = findRepositoryUrl(new File(projectRootPath));
            if (repoUrl != null) {
                System.out.println("Found repository URL: " + repoUrl);

                // Step 2: Clone or fetch the repository
                Git git = Git.cloneRepository()
                        .setURI(repoUrl)
                        .setDirectory(new File(localRepoPath))
                        .setCredentialsProvider(new UsernamePasswordCredentialsProvider(username, token))
                        .call();

                System.out.println("Repository cloned to " + localRepoPath);
                git.close();
            } else {
                System.out.println("Repository URL not found in the project.");
            }
        } catch (IOException | GitAPIException e) {
            e.printStackTrace();
        }
    }

    // Searches for the repository URL in known files
    public static String findRepositoryUrl(File projectRoot) throws IOException {
        File configFile = new File(projectRoot, "config.properties"); // Look in config.properties first
        if (configFile.exists()) {
            return extractUrlFromFile(configFile);
        }

        // Check .git/config as a fallback if config.properties isn't present
        File gitConfigFile = new File(projectRoot, ".git/config");
        if (gitConfigFile.exists()) {
            return extractUrlFromFile(gitConfigFile);
        }
        
        return null;
    }

    // Extracts the repository URL from a file
    public static String extractUrlFromFile(File file) throws IOException {
        Pattern urlPattern = Pattern.compile("https?://[\\w\\.-]+(?:/|\\w)*\\.git"); // Regex for a URL ending with .git
        try (BufferedReader reader = new BufferedReader(new FileReader(file))) {
            String line;
            while ((line = reader.readLine()) != null) {
                Matcher matcher = urlPattern.matcher(line);
                if (matcher.find()) {
                    return matcher.group();
                }
            }
        }
        return null;
    }
}


Explanation

	1.	projectRootPath: The local project path to search for the repository URL.
	2.	findRepositoryUrl(): Searches for the repository URL within config.properties or .git/config files.
	3.	extractUrlFromFile(): Reads through the file to find a URL matching the pattern ending in .git.
	4.	Cloning the Repository: Uses the URL to clone the repository with authentication, if required.

Environment Variables for Security

Store sensitive data like GIT_USERNAME and GIT_TOKEN as environment variables. The program will look up these variables and use default placeholders if not found.

This approach allows flexibility in handling repository URLs and cloning them dynamically from the project setup.


------------------------------------------------------------------------------------------------------------------------

f SSH is configured for accessing the Git repository, the approach will differ slightly since SSH keys handle authentication instead of a username and token. With JGit, SSH authentication can be set up using an SshSessionFactory that loads the SSH private key.

Here’s how to adjust the Java program to handle SSH-based authentication.

Steps for SSH Authentication

	1.	Ensure that SSH keys are already configured on the machine and added to the SSH agent.
	2.	Use JschConfigSessionFactory from JGit to manage the SSH session and load the private key.
	3.	Adjust the code to handle an SSH-based repository URL.

Updated Java Code Example with SSH

This example uses SshSessionFactory to set up SSH configuration for JGit.


import org.eclipse.jgit.api.Git;
import org.eclipse.jgit.api.errors.GitAPIException;
import org.eclipse.jgit.transport.JschConfigSessionFactory;
import org.eclipse.jgit.transport.SshSessionFactory;
import org.eclipse.jgit.util.FS;
import com.jcraft.jsch.JSch;
import com.jcraft.jsch.JSchException;
import com.jcraft.jsch.Session;

import java.io.BufferedReader;
import java.io.File;
import java.io.FileReader;
import java.io.IOException;
import java.util.regex.Matcher;
import java.util.regex.Pattern;

public class GitRepositorySSHFetcher {
    public static void main(String[] args) {
        String projectRootPath = "path/to/your/project"; // Path to your local project folder
        String localRepoPath = "path/to/clone/repo";     // Where you want to clone the repo

        try {
            // Step 1: Search for the repository URL
            String repoUrl = findRepositoryUrl(new File(projectRootPath));
            if (repoUrl != null && repoUrl.startsWith("git@")) { // Check if SSH URL
                System.out.println("Found SSH repository URL: " + repoUrl);

                // Step 2: Configure SSH session
                SshSessionFactory sshSessionFactory = new JschConfigSessionFactory() {
                    @Override
                    protected void configure(com.jcraft.jsch.OpenSSHConfig.Host hc, Session session) {
                        session.setConfig("StrictHostKeyChecking", "no");
                    }

                    @Override
                    protected JSch createDefaultJSch(FS fs) throws JSchException {
                        JSch jsch = super.createDefaultJSch(fs);
                        // Load SSH key from default location (~/.ssh/id_rsa or configured location)
                        jsch.addIdentity(System.getProperty("user.home") + "/.ssh/id_rsa");
                        return jsch;
                    }
                };
                SshSessionFactory.setInstance(sshSessionFactory);

                // Step 3: Clone or fetch the repository using SSH
                Git git = Git.cloneRepository()
                        .setURI(repoUrl)
                        .setDirectory(new File(localRepoPath))
                        .setTransportConfigCallback(transport -> 
                                transport.setSshSessionFactory(sshSessionFactory))
                        .call();

                System.out.println("Repository cloned to " + localRepoPath);
                git.close();
            } else {
                System.out.println("No SSH repository URL found in the project.");
            }
        } catch (IOException | GitAPIException e) {
            e.printStackTrace();
        }
    }

    // Searches for the repository URL in known files
    public static String findRepositoryUrl(File projectRoot) throws IOException {
        File configFile = new File(projectRoot, "config.properties"); // Look in config.properties first
        if (configFile.exists()) {
            return extractUrlFromFile(configFile);
        }

        // Check .git/config as a fallback if config.properties isn't present
        File gitConfigFile = new File(projectRoot, ".git/config");
        if (gitConfigFile.exists()) {
            return extractUrlFromFile(gitConfigFile);
        }
        
        return null;
    }

    // Extracts the repository URL from a file
    public static String extractUrlFromFile(File file) throws IOException {
        Pattern urlPattern = Pattern.compile("(git@|https?://)[\\w\\.-]+:(?:/|\\w)*\\.git"); // Regex for SSH or HTTPS URL
        try (BufferedReader reader = new BufferedReader(new FileReader(file))) {
            String line;
            while ((line = reader.readLine()) != null) {
                Matcher matcher = urlPattern.matcher(line);
                if (matcher.find()) {
                    return matcher.group();
                }
            }
        }
        return null;
    }
}



Explanation

	1.	SSH Configuration with JschConfigSessionFactory:
	•	The custom JschConfigSessionFactory loads the SSH private key (typically located at ~/.ssh/id_rsa).
	•	You can customize the path if needed or add additional configurations for SSH.
	2.	Checking for SSH URL:
	•	The program verifies that the URL starts with git@ (SSH) to differentiate from HTTPS URLs.
	3.	Cloning with SSH:
	•	The .setTransportConfigCallback() method allows setting the SSH session factory, enabling JGit to connect via SSH.

Notes

	•	This code assumes the SSH key has no passphrase, or that an SSH agent is managing the key. If a passphrase is required, you’ll need additional handling for passphrase input.
	•	Make sure your SSH key has access permissions for the Git repository.

This setup allows JGit to securely connect to Git repositories over SSH.
